<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Network Traffic Dashboard</title>
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .darken-background {
            background-color: rgba(0, 0, 0, 1);
            /* Completely opaque black background */
        }

        :root {
            --background-color: #f7f8fa;
            /* Soft off-white, good for backgrounds */
            --navbar-color: #ffffff;
            /* Clean white for the navbar */
            --card-color: #ffffff;
            /* White for the card backgrounds */
            --card-shadow: rgba(100, 100, 111, 0.2) 0px 7px 29px 0px;
            /* Subtle shadow for depth */
            --text-color: #313131;
            /* Darker text for better readability */
            --header-bg-color: #4a5568;
            /* Darker shade of blue-grey for headers */
            --header-text-color: #ffffff;
            /* White text for headers */
            --list-item-bg-color: #edf2f7;
            /* Lighter grey for list items */
            --border-color: #e2e8f0;
            /* Light grey for borders and lines */
            --accent-color: #2b6cb0;
            /* Calm blue for accents */
            --success-color: #48bb78;
            /* Green for success messages */
            --error-color: #f56565;
            /* Red for error messages */
            --warning-color: #ecc94b;
            /* Yellow for warnings */
            --navbar-text-color: #ffffff;
            /* White color for text in the navbar */
            --navbar-button-color: #ffffff;
            /* White color for buttons in the navbar */
            --navbar-button-border-color: #2b6cb0;
            /* Border color for buttons in the navbar */
        }

        body {
            background-color: var(--background-color);
            color: var(--text-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding-top: 60px;
        }

        .navbar-custom {
            background-color: var(--navbar-color);
            box-shadow: var(--card-shadow);
        }

        .navbar-brand {
            color: var(--accent-color);
        }

        .card {
            background-color: var(--card-color);
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
            border-radius: 0.25rem;
        }

        .card-header {
            background-color: var(--header-bg-color);
            color: var(--header-text-color);
        }

        .card-body {
            color: var(--text-color);
        }

        .data-point {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-color);
        }

        .data-label {
            font-weight: 600;
            color: var(--accent-color);
        }

        .data-list li {
            background-color: var(--list-item-bg-color);
            border-left: 4px solid var(--accent-color);
            padding: 0.5rem;
            margin-bottom: 0.25rem;
        }

        .container h2 {
            cursor: pointer;
            background-color: #f9f9f9;
            padding: 15px 20px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            margin-top: 20px;
            position: relative; /* For positioning icons or pseudo-elements */
            font-weight: 600; /* Makes font bolder */
            transition: background-color 0.3s ease; /* Smooth transition for hover effect */
        }
        
        .container h2:hover {
            background-color: #e9e9e9; /* Light change on hover */
        }
        
        .container h2::before {
            content: ''; /* Add a pseudo-element for an icon or color accent */
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 70%;
            background-color: #007bff; /* Example accent color */
            border-radius: 2px;
        }
        

        #bandwidthGauge,
        #latency,
        #jitter,
        #data,
        #packet,
        #allowed,
        #availability,
        #intrusion {
            margin: 0 auto;
            display: block;
        }

        .modal-content {
            background-color: var(--card-color);
            color: var(--text-color);
        }

        .modal-header {
            background-color: var(--header-bg-color);
            color: var(--header-text-color);
        }

        /* Status classes for text */
        .text-success {
            color: var(--success-color);
        }

        .text-error {
            color: var(--error-color);
        }

        .text-warning {
            color: var(--warning-color);
        }

        .navbar-custom {
            background-color: var(--navbar-color);
            box-shadow: var(--card-shadow);
        }

        .navbar-custom .navbar-brand,
        .navbar-custom .navbar-nav .nav-link {
            color: var(--text-color);
            ;
        }

        .navbar-custom .btn-outline-light {
            color: var(--text-color);
            border-color: var(--text-color);
        }

        .navbar-custom .btn-outline-light:hover {
            background-color: var(--navbar-button-color);
            color: var(--text-color);
        }

        .row {
            margin-top: 2em;
        }

        #computer{
            display: block;
        }





        /* Additional styles for buttons and form elements can be added here */
    </style>
</head>

<body id="body">
    <div class="container mt-5" id="dashboard-container" style="display: none;">
        <nav class="navbar navbar-expand-lg navbar-custom fixed-top">
            <div class="container">
                <a class="navbar-brand" href="#">Network Dashboard</a>
                <button class="btn btn-outline-light my-2 my-sm-0" id="text" type="button" id="logoutButton"
                    onclick="logout()">Logout</button>
            </div>
        </nav>
        </nav>

        <div class="container mt-5">

                <h2>Network Health</h2>
                <div class="Network_Health">
            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">Bandwidth</div>
                        <div class="card-body">

                            <span class="data-label">Current Bandwidth: </span>
                            <span id="bandwidth" class="data-point">N/A</span>
                            <canvas id="bandwidthGauge" width="400" height="200"></canvas>


                        </div>
                    </div>
                </div>

                <div class="col-md-3">
                    <div class="card">
                        <div class="card-header">Latency</div>
                        <div class="card-body">
                            <span class="data-label">Current Latency: </span>
                            <span id="latency" class="data-point">N/A</span>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card">
                        <div class="card-header">Current Jitter</div>
                        <div class="card-body">
                            <span class="data-label">Current Jitter: </span>
                            <span id="jitter" class="data-point">N/A</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>




            <h2>Packet Information</h2>
            <div class="Packets_Information">
            <div class="row">

                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">Amount of data Transferred</div>
                        <div class="card-body">
                            <span class="data-label">Current Data: </span>
                            <span id="data" class="data-point">N/A</span>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">Amount of Packets Transferred</div>
                        <div class="card-body">
                            <span class="data-label">Current Packets: </span>
                            <span id="packet" class="data-point">N/A</span>
                        </div>
                    </div>
                </div>

            </div>
        </div>




            <h2>Security and Availability</h2>
            <div class="Security">
            <div class="row">

                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">Authorization on Computer Usage</div>
                        <div class="card-body">
                            <span class="data-label">Password Status: </span>
                            <span id="allowed" class="data-point">N/A</span>

                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">Computers Available To Use</div>
                        <div class="card-body">
                            <span class="data-label" >Availability: </span>
                            <span id="availability" style="display: none;" class="data-point">N/A</span>
                            <img id="computer" src="pc_icon.png" alt="images">
                            <div id="availability-container"></div>

                        </div>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="card">
                        <div class="card-header">Intruder Detector</div>
                        <div class="card-body">
                            <span class="data-label">Threats: </span>
                            <span id="intrusion" class="data-point">N/A</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>




            <h2>Environment Conditions</h2>
            <div class="Environment">
            <div class="row">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">Temperature</div>
                        <div class="card-body">
                            <span class="data-label">Current Temperature: </span>
                            <span id="temperature" class="data-point">N/A</span>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">Humidity</div>
                        <div class="card-body">
                            <span class="data-label">Current Humidity: </span>
                            <span id="humidity" class="data-point">N/A</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>




        <h2>Network Traffic Information</h2>
        <div class="Network">

            <div class="row">
                <div class="col-md-6">
                    <div class="card" id="card-white">
                        <div class="card-header">Top Destination IP</div>
                        <div class="card-body">
                            <span class="data-label">IP Address: </span>
                            <span id="top_dest_ip" class="data-point" style="display:none">N/A</span>
                            <canvas id="ipChart"></canvas>

                        </div>
                    </div>
                </div>


                <div class="col-md-6">
                    <div class="card" id="card-white">
                        <div class="card-header">Top Source IPs</div>
                        <div class="card-body">
                            <span class="data-label">IP Address: </span>
                            <span id="top_src_ip" class="data-point" style="display:none">N/A</span>
                            <canvas id="ipSrcChart"></canvas>

                        </div>
                    </div>
                </div>

            </div>


            <div class="row">
                <div class="col-md-6">
                    <div class="card" id="card-white">
                        <div class="card-header">Top Protocol</div>
                        <div class="card-body">
                            <span class="data-label">Protocol: </span>
                            <span id="top_protocol" class="data-point" style="display:none">N/A</span>
                            <canvas id="protocolChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="col-md-6">
                    <div class="card" id="card-white">
                        <div class="card-header">Top DNS</div>
                        <div class="card-body">
                            <span class="data-label">DNS: </span>
                            <span id="top_dns" class="data-point" style="display:none">N/A</span>
                            <canvas id="dnsChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

    </div>
</div>

    </div>

    <!-- Login Modal -->
    <div class="modal" id="loginModal" tabindex="-1" role="dialog">
        <div class="modal-dialog" role="document">
            <div class="modal-content" style="background-color: var(--card-color);">
                <div class="modal-header" style="background-color: var(--header-bg-color);">
                    <h5 class="modal-title" style="color: white;">Login</h5>
                </div>
                <div class="modal-body">
                    <input type="email" id="email" class="form-control mb-2" placeholder="Email">
                    <input type="password" id="password" class="form-control mb-2" placeholder="Password">
                    <button onclick="login()" class="btn btn-primary">Login</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/js/bootstrap.min.js"></script>




    <!-- Firebase Initialization -->
    <script src="https://www.gstatic.com/firebasejs/3.7.4/firebase.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.7.4/firebase-auth.js"></script>
    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyDKco5ay2xPggs8uYZ5PeBzd4rVLVEqzRM",
            authDomain: "test-1-711d6.firebaseapp.com",
            databaseURL: "https://test-1-711d6-default-rtdb.firebaseio.com/",
            projectId: "test-1-711d6",
            storageBucket: "test-1-711d6.appspot.com",
            messagingSenderId: "89445318257",
            appId: "1:89445318257:web:cce08ff8f73104499aa5d0",
            measurementId: "G-RHC6PV8GZC"
        };
        firebase.initializeApp(firebaseConfig);

        function updateDashboard(bandwidth, latency, jitter, data, packet, topDestIp, topProtocol, topSrcIp) {
            document.getElementById('bandwidth').textContent = bandwidth || 'N/A';
            document.getElementById('latency').textContent = latency || 'N/A';
            document.getElementById('jitter').textContent = jitter || 'N/A';
            document.getElementById('data').textContent = data || 'N/A';
            document.getElementById('packet').textContent = packet || 'N/A';
            updateList('top_dest_ip', topDestIp.split(','));
            updateList('top_protocol', topProtocol.split(','));
            updateList('top_src_ip', topSrcIp.split(','));
        }

        function updateDns(topDns) {
            updateList('top_dns', topDns.split(','));
        }

        function updateList(listId, items) {
            const listElement = document.getElementById(listId);
            listElement.innerHTML = ''; // Clear existing list items
            var counter = 1;
            items.forEach(item => {
                const listItem = document.createElement('li');
                listItem.textContent = counter + ". " + item;
                counter++;
                listItem.className = 'list-group-item';
                listElement.appendChild(listItem);

            });
        }





        const networkTrafficRef = firebase.database().ref('NetworkTraffic/summary');
        networkTrafficRef.on('value', function (snapshot) {
            const data = snapshot.val();
            updateDashboard(data.bandwidth, data.average_latency, data.average_jitter, data.total_data_transfer, data.total_packets, data.top_dest_ips.map(ipData => ipData[0]).join(','), data.top_protocols.map(protocolData => protocolData[0]).join(','), data.top_src_ips.map(srcIpData => srcIpData[0]).join(','));
            //Check this
            var ip = data.top_dest_ips.map(ipData => ipData[0]).join(',');
            if (ip.includes("10.50.236.144")) {
                document.getElementById('intrusion').textContent = "Intruder Detected";
                document.getElementById('intrusion').style.color = "#f56565";
                document.getElementById('body').style.backgroundColor = "#f56565";
                changeIntruderStatus();
            } else {
                document.getElementById('intrusion').textContent = "System is safe";
                document.getElementById('intrusion').style.color = "green";
                document.getElementById('body').style.backgroundColor = "#f7f8fa";

                changeSafeStatus();
            }


            // Define a color palette
            const chartColors = {
                blue: 'rgba(43, 108, 176, 0.7)', // A soft blue
                gray: 'rgba(105, 105, 105, 0.7)', // A medium gray
                green: 'rgba(72, 187, 120, 0.7)', // A soft green for success
                red: 'rgba(245, 101, 101, 0.7)', // A soft red for errors
                yellow: 'rgba(236, 201, 75, 0.7)', // A soft yellow for warnings
                purple: 'rgba(108, 92, 231, 0.7)', // A soft purple
                orange: 'rgba(255, 165, 0, 0.7)' // A soft orange
            };

            //Defining Constants

            //Getting the data from the database
            const ips_packets = data.top_dest_ips.map(ipData => ipData[1]);
            const ip_names = data.top_dest_ips.map(ipData => ipData[0]);

            const src_ips_packets = data.top_src_ips.map(ipData => ipData[1]);
            const src_ip_names = data.top_src_ips.map(ipData => ipData[0]);

            const protocol_names = data.top_protocols.map(protocolData => protocolData[0]);
            const protocol_packets = data.top_protocols.map(protocolData => protocolData[1]);



            let delayed;

            // Generate dynamic colors for each bar
            const barColors = ip_names.map((_, i) => Object.values(chartColors)[i % Object.values(chartColors).length]);
            const pieColors = ip_names.map((_, i) => Object.values(chartColors)[i % Object.values(chartColors).length]);

            //Initialize the chart
            const ctx = document.getElementById('ipChart').getContext('2d');
            const cty = document.getElementById('protocolChart').getContext('2d');
            const cta = document.getElementById('ipSrcChart').getContext('2d');






            //Dest Ip chart
            const ipChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ip_names, // This will place each IP name under its corresponding bar
                    datasets: [{
                        label: 'Amount of Packets',
                        data: ips_packets,
                        backgroundColor: barColors,
                        borderColor: 'rgba(0,0,0)',
                        borderWidth: 2,
                        borderRadius: 5,
                    }]
                },
                options: {
                    responsive: true,

                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true
                            }
                        }],
                        xAxes: [{
                            ticks: {
                                autoSkip: false,
                                callback: function (value, index, values) {
                                    // This callback can be used to format the x-axis labels
                                    return ip_names[index]; // Return the name of the IP for each bar
                                }
                            }
                        }]
                    },
                    animation: {
                        onComplete: () => {
                            delayed = true;
                        },
                        delay: (context) => {
                            let delay = 0;
                            if (context.type === 'data' && context.mode === 'default' && !delayed) {
                                delay = context.dataIndex * 300 + context.datasetIndex * 100;
                            }
                            return delay;
                        },
                    },
                    hover: {
                        animationDuration: 2000
                    },
                    // If your Chart.js version supports plugins, this could also ensure the legend is not displayed
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom', // optional

                            labels: {
                                generateLabels: function (chart) {
                                    // 'chart' parameter is the chart instance
                                    const datasets = chart.data.datasets[0];
                                    return datasets.backgroundColor.map(function (backgroundColor, index) {
                                        return {
                                            text: chart.data.labels[index], // Customize label text
                                            fillStyle: backgroundColor,
                                            // Additional styling can be done here
                                        };
                                    });
                                }
                            }
                        }
                    }
                }
            });



            const protocolChart = new Chart(cty, {
                type: 'pie',
                data: {
                    labels: protocol_names, // This will place each IP name under its corresponding bar
                    datasets: [{
                        label: 'Amount of Packets',
                        data: protocol_packets,
                        backgroundColor: pieColors,
                        borderColor: 'rgba(0,0,0)',
                        borderWidth: 2,
                        borderRadius: 5,
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true
                            }
                        }],
                        xAxes: [{
                            ticks: {
                                autoSkip: false,
                                callback: function (value, index, values) {
                                    // This callback can be used to format the x-axis labels
                                    return ip_names[index]; // Return the name of the IP for each bar
                                }
                            }
                        }]
                    },
                    animation: {
                        onComplete: () => {
                            delayed = true;
                        },
                        delay: (context) => {
                            let delay = 0;
                            if (context.type === 'data' && context.mode === 'default' && !delayed) {
                                delay = context.dataIndex * 300 + context.datasetIndex * 100;
                            }
                            return delay;
                        },
                    },
                    hover: {
                        animationDuration: 2000
                    },
                    // If your Chart.js version supports plugins, this could also ensure the legend is not displayed
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom', // optional

                            labels: {
                                generateLabels: function (chart) {
                                    // 'chart' parameter is the chart instance
                                    const datasets = chart.data.datasets[0];
                                    return datasets.backgroundColor.map(function (backgroundColor, index) {
                                        return {
                                            text: chart.data.labels[index], // Customize label text
                                            fillStyle: backgroundColor,
                                            // Additional styling can be done here
                                        };
                                    });
                                }
                            }
                        }
                    }
                }
            });




            // Sample data for the gauge
            var bandwidth = parseFloat(data.bandwidth);
            const bandwidthRawData = [bandwidth, 5];
            // Update the colors for the gauge chart to match
            const bandwidthGaugeColors = [chartColors.blue, chartColors.gray];
            const bandwidthData = {
                // Assuming 0 to 100 for demonstration; you'll need to adjust this based on your actual bandwidth data
                labels: ["Bandwidth", "Unused"],
                datasets: [{
                    data: bandwidthRawData, // First value is the used bandwidth, second value is the unused bandwidth
                    backgroundColor: bandwidthGaugeColors, // Color for the used bandwidth and unused for the rest
                    borderWidth: 0 // No border
                }]
            };

            const config = {
                type: 'doughnut',
                data: bandwidthData,
                options: {
                    rotation: 270, // Start the doughnut at 180 degrees
                    circumference: 180, // End the doughnut at 360 degrees (half a doughnut)

                    responsive: false,
                    maintainAspectRatio: true,
                    aspectRatio: 2, // You can adjust this value as needed
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom', // optional

                            labels: {
                                generateLabels: function (chart) {
                                    // 'chart' parameter is the chart instance
                                    const datasets = chart.data.datasets[0];
                                    return datasets.backgroundColor.map(function (backgroundColor, index) {
                                        return {
                                            text: chart.data.labels[index], // Customize label text
                                            fillStyle: backgroundColor,
                                            // Additional styling can be done here
                                        };
                                    });
                                }
                            }
                        }
                    },
                    // Disable animations for a static gauge-like view
                    animation: {
                        animateRotate: false,
                        animateScale: false
                    },
                }
            };

            // Create the chart
            const ctz = document.getElementById('bandwidthGauge').getContext('2d');
            const bandwidthGauge = new Chart(ctz, config);






            //Src Ip chart


            const ipSrcChart = new Chart(cta, {
                type: 'bar',
                data: {
                    labels: src_ip_names, // This will place each IP name under its corresponding bar
                    datasets: [{
                        label: 'Amount of Packets',
                        data: src_ips_packets,
                        backgroundColor: barColors,
                        borderColor: 'rgba(0,0,0)',
                        borderWidth: 2,
                        borderRadius: 5,
                    }]
                },
                options: {
                    responsive: true,

                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true
                            }
                        }],
                        xAxes: [{
                            ticks: {
                                autoSkip: false,
                                callback: function (value, index, values) {
                                    // This callback can be used to format the x-axis labels
                                    return ip_names[index]; // Return the name of the IP for each bar
                                }
                            }
                        }]
                    },
                    animation: {
                        onComplete: () => {
                            delayed = true;
                        },
                        delay: (context) => {
                            let delay = 0;
                            if (context.type === 'data' && context.mode === 'default' && !delayed) {
                                delay = context.dataIndex * 300 + context.datasetIndex * 100;
                            }
                            return delay;
                        },
                    },
                    hover: {
                        animationDuration: 2000
                    },
                    // If your Chart.js version supports plugins, this could also ensure the legend is not displayed
                    plugins: {
                        legend: {
                            display: true,
                            position: 'bottom', // optional

                            labels: {
                                generateLabels: function (chart) {
                                    // 'chart' parameter is the chart instance
                                    const datasets = chart.data.datasets[0];
                                    return datasets.backgroundColor.map(function (backgroundColor, index) {
                                        return {
                                            text: chart.data.labels[index], // Customize label text
                                            fillStyle: backgroundColor,
                                            // Additional styling can be done here
                                        };
                                    });
                                }
                            }
                        }
                    }
                }
            });






        });





        function login() {
            var email = document.getElementById('email').value;
            var password = document.getElementById('password').value;
            firebase.auth().signInWithEmailAndPassword(email, password)
                .then((userCredential) => {
                    // Signed in
                    $('#loginModal').modal('hide'); // Hide modal on successful login
                })
                .catch((error) => {
                    // Handle Errors here.
                    alert("Invalid Username and Password"); // Show error message
                });
        }
        $(document).ready(function () {
            $('body').addClass('darken-background');
            $('#loginModal').modal({
                backdrop: 'static', // Prevent closing by clicking outside
                keyboard: false, // Prevent closing with keyboard
                show: true // Show immediately
            });
        });



        firebase.auth().onAuthStateChanged((user) => {
            if (user) {
                $('body').removeClass('darken-background');
                $('#loginModal').modal('hide');
                $('#dashboard-container').show(); // Show dashboard content
            } else {
                $('body').addClass('darken-background');
                $('#loginModal').modal('show');
                $('#dashboard-container').hide(); // Hide dashboard content
            }
        });

        function logout() {
            firebase.auth().signOut().then(() => {
                // Sign-out successful.
                $('#loginModal').modal('show');
                $('body').addClass('darken-background');
                $('#dashboard-container').hide(); // Hide the dashboard content
            }).catch((error) => {
                // An error happened.
                console.error('Logout Failed', error);
            });
        }


        // Listen for changes in temperature and humidity values
        var sensorDataRef = firebase.database().ref('Password');
        sensorDataRef.on('value', function (snapshot) {
            var data = snapshot.val();

            if (data == '123') {
                document.getElementById('allowed').textContent = "Allowed";
                document.getElementById('allowed').style.color = "green";
                //changePasswordStatus();
                changeAllowedStatus();
            }else {
                document.getElementById('allowed').textContent = "Denied";
                document.getElementById('allowed').style.color = "#f56565";
                changeDeniedStatus();
            }


        });

        // Listen for changes in temperature and humidity values
        var sensorDataRef = firebase.database().ref('Availability');
        sensorDataRef.on('value', function (snapshot) {
            var data = snapshot.val();


            if (data) {
                document.getElementById('availability').textContent = data;


                    if(data == 1){
                        document.getElementById('computer').style.display = 'block'; // Set any required styles
                    }else if(data == 0){
                        document.getElementById('computer').style.display = 'none'; // Set any required styles
                    }
                    
                
            }

        });

        // Listen for changes in temperature and humidity values
        var sensorDataRef = firebase.database().ref('temperature');
        sensorDataRef.on('value', function (snapshot) {
            var data = snapshot.val();

            if (data) {
                document.getElementById('temperature').textContent = data+"°C";
                document.getElementById('temperature').style.color = "black";

            }

            if(data > 25){
                document.getElementById('temperature').style.color = "#f56565";
                document.getElementById('temperature').textContent = data+"°C Environment is too hot for the system";
            }


        });

        // Listen for changes in temperature and humidity values
        var sensorDataRef = firebase.database().ref('humidity');
        sensorDataRef.on('value', function (snapshot) {
            var data = snapshot.val();

            if (data) {
                document.getElementById('humidity').textContent = data+"%";
                document.getElementById('humidity').style.color = "black";


            }
            if(data > 50){
                document.getElementById('humidity').style.color = "#f56565";
                document.getElementById('humidity').textContent = data+"% Environment is too humid for the system";
            }

        });


        networkTrafficRef.on('value', function (snapshot) {
            const data = snapshot.val();

            updateDns(data.top_dns.map(dnsData => dnsData[0]).join(','));

                        // Define a color palette
                        const chartColors = {
                            blue: 'rgba(43, 108, 176, 0.7)', // A soft blue
                            gray: 'rgba(105, 105, 105, 0.7)', // A medium gray
                            green: 'rgba(72, 187, 120, 0.7)', // A soft green for success
                            red: 'rgba(245, 101, 101, 0.7)', // A soft red for errors
                            yellow: 'rgba(236, 201, 75, 0.7)', // A soft yellow for warnings
                            purple: 'rgba(108, 92, 231, 0.7)', // A soft purple
                            orange: 'rgba(255, 165, 0, 0.7)' // A soft orange
                        };


            let delayed;

            const dns_packets = data.top_dns.map(ipData => ipData[1]);
            const dns_names = data.top_dns.map(ipData => ipData[0]);
            const ctb = document.getElementById('dnsChart').getContext('2d');
            // Generate dynamic colors for each bar

            const pieColors = dns_names.map((_, i) => Object.values(chartColors)[i % Object.values(chartColors).length]);

                        //Dns chart


                        const dnsChart = new Chart(ctb, {
                            type: 'pie',
                            data: {
                                labels: dns_names, // This will place each IP name under its corresponding bar
                                datasets: [{
                                    label: 'Amount of Packets',
                                    data: dns_packets,
                                    backgroundColor: pieColors,
                                    borderColor: 'rgba(0,0,0)',
                                    borderWidth: 2,
                                    borderRadius: 5,
                                }]
                            },
                            options: {
                                responsive: true,
                                scales: {
                                    yAxes: [{
                                        ticks: {
                                            beginAtZero: true
                                        }
                                    }],
                                    xAxes: [{
                                        ticks: {
                                            autoSkip: false,
                                            callback: function (value, index, values) {
                                                // This callback can be used to format the x-axis labels
                                                return ip_names[index]; // Return the name of the IP for each bar
                                            }
                                        }
                                    }]
                                },
                                animation: {
                                    onComplete: () => {
                                        delayed = true;
                                    },
                                    delay: (context) => {
                                        let delay = 0;
                                        if (context.type === 'data' && context.mode === 'default' && !delayed) {
                                            delay = context.dataIndex * 300 + context.datasetIndex * 100;
                                        }
                                        return delay;
                                    },
                                },
                                hover: {
                                    animationDuration: 2000
                                },
                                // If your Chart.js version supports plugins, this could also ensure the legend is not displayed
                                plugins: {
                                    legend: {
                                        display: true,
                                        position: 'bottom', // optional
            
                                        labels: {
                                            generateLabels: function (chart) {
                                                // 'chart' parameter is the chart instance
                                                const datasets = chart.data.datasets[0];
                                                return datasets.backgroundColor.map(function (backgroundColor, index) {
                                                    return {
                                                        text: chart.data.labels[index], // Customize label text
                                                        fillStyle: backgroundColor,
                                                        // Additional styling can be done here
                                                    };
                                                });
                                            }
                                        }
                                    }
                                }
                            }
                        });

        });



        function changeAllowedStatus() {
            var AllowedStatusRef = firebase.database().ref('Allowed');
            AllowedStatusRef.set('True');
        }

        function changeDeniedStatus() {
            var AllowedStatusRef = firebase.database().ref('Allowed');
            AllowedStatusRef.set('False');
        }

        function changeIntruderStatus() {
            var AllowedStatusRef = firebase.database().ref('Intruder');
            AllowedStatusRef.set('True');
        }

        function changeSafeStatus() {
            var AllowedStatusRef = firebase.database().ref('Intruder');
            AllowedStatusRef.set('False');
        }

        function changePasswordStatus() {
            var AllowedStatusRef = firebase.database().ref('Password');
            AllowedStatusRef.set('0');
        }

        document.querySelectorAll('h2').forEach(function(header) {
            header.addEventListener('click', function() {
                // Assuming the section content is the next sibling of the h2 element
                var content = this.nextElementSibling;
                if (content.style.display === "none") {
                    content.style.display = "block";
                } else {
                    content.style.display = "none";
                }
            });
        });

        /*setInterval(function() {
            window.location.reload();
        }, 10000); // 10000 milliseconds = 10 seconds
        */
        
    </script>
</body>

</html>